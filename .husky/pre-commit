#!/bin/sh

echo "ğŸ”¨ Running pre-commit checks..."

# Detect which directories have changes
WEB_CHANGED=$(git diff --cached --name-only | grep '^web/' || true)
API_CHANGED=$(git diff --cached --name-only | grep '^api/' || true)

# Run web checks only if web files changed
if [ -n "$WEB_CHANGED" ]; then
  echo ""
  echo "ğŸ“¦ Web: Building..."
  npm run web:build || exit 1

  echo ""
  echo "ğŸ” Web: Linting..."
  npm run web:lint || exit 1

  echo ""
  echo "ğŸ§ª Web: Testing..."
  npm run web:test || exit 1
else
  echo ""
  echo "â­ï¸  Web: No changes detected, skipping checks"
fi

# Run API checks only if API files changed
if [ -n "$API_CHANGED" ]; then
  echo ""
  echo "ğŸ“¦ API: Building..."
  npm run api:build || exit 1

  echo ""
  echo "ğŸ¨ API: Formatting check..."
  npm run api:format:check || exit 1

  echo ""
  echo "ğŸ§ª API: Testing..."
  npm run api:test || exit 1
else
  echo ""
  echo "â­ï¸  API: No changes detected, skipping checks"
fi

echo ""
echo "âœ… All checks passed!"
